# Halo VSCode 扩展 - API 客户端迁移指南\n\n## 概述\n\n根据对当前代码的分析和编译结果，确认了 Halo 2.21 的兼容性问题。主要问题是 `@halo-dev/api-client` 包中的 API 类名发生了变化。\n\n## 主要变化\n\n### 1. API 类名变化\n\n| 旧版 API 类名 | 新版 API 类名 | 状态 |\n|---------------|---------------|------|\n| `UcApiContentHaloRunV1alpha1PostApi` | `PostV1alpha1UcApi` | ✅ 已确认 |\n| `UcApiContentHaloRunV1alpha1AttachmentApi` | `AttachmentV1alpha1UcApi` | ✅ 已确认 |\n\n### 2. 构造函数变化\n\n**旧版用法：**\n```typescript\nimport {\n  UcApiContentHaloRunV1alpha1PostApi,\n  UcApiContentHaloRunV1alpha1AttachmentApi,\n} from \"@halo-dev/api-client\";\n\nthis.postApi = new UcApiContentHaloRunV1alpha1PostApi(\n  undefined,\n  site.url,\n  axiosInstance,\n);\n```\n\n**新版用法：**\n```typescript\nimport {\n  PostV1alpha1UcApi,\n  AttachmentV1alpha1UcApi,\n} from \"@halo-dev/api-client\";\n\nthis.postApi = new PostV1alpha1UcApi(\n  undefined,\n  site.url,\n  axiosInstance,\n);\n```\n\n### 3. 方法名变化\n\n根据新版 API 客户端的导出列表，以下方法名可能需要调整：\n\n| 功能 | 旧版方法 | 新版方法 |\n|------|----------|----------|\n| 发布文章 | `publishMyPost` | 需要验证具体方法名 |\n| 获取文章列表 | `listMyPosts` | 需要验证具体方法名 |\n| 创建文章 | `createMyPost` | 需要验证具体方法名 |\n| 更新文章 | `updateMyPost` | 需要验证具体方法名 |\n\n## 迁移步骤\n\n### 第一阶段：更新服务类导入\n\n1. 更新 `src/service/index.ts` 中的导入语句\n2. 更新构造函数中的 API 实例化\n3. 测试基本连接功能\n\n### 第二阶段：方法名适配\n\n1. 检查并更新所有 API 方法调用\n2. 更新错误处理逻辑\n3. 测试完整的发布流程\n\n### 第三阶段：兼容性测试\n\n1. 在 Halo 2.21 环境中进行完整测试\n2. 验证所有功能（发布、拉取、更新、图片上传等）\n3. 性能和稳定性测试\n\n## 代码修改清单\n\n### 文件：`src/service/index.ts`\n\n- [ ] 更新导入语句\n- [ ] 更新构造函数\n- [ ] 测试 API 连接\n\n### 文件：`src/commands/setup.ts`\n\n- [ ] 更新 API 实例化代码\n\n### 文件：所有命令文件\n\n- [ ] 检查方法调用\n- [ ] 更新错误处理\n\n## 风险评估\n\n### 高风险项\n- API 方法签名可能发生变化\n- 错误响应格式可能不同\n- 认证流程可能有细微调整\n\n### 缓解措施\n- 先在测试环境验证\n- 保持向后兼容的错误处理\n- 分阶段发布更新\n\n## 验证检查表\n\n- [ ] 站点连接测试\n- [ ] 用户认证测试\n- [ ] 文章发布测试\n- [ ] 文章更新测试\n- [ ] 图片上传测试\n- [ ] 分类和标签管理测试\n- [ ] 错误情况处理测试\n\n## 回滚计划\n\n如果新版本存在问题，可以：\n1. 回退到兼容的 `@halo-dev/api-client` 版本\n2. 使用 git 回退到稳定版本\n3. 发布热修复版本\n\n## 预期收益\n\n- ✅ 完全兼容 Halo 2.21\n- ✅ 获得新版 API 的性能改进\n- ✅ 为未来的功能扩展做准备\n- ✅ 提高代码的可维护性 